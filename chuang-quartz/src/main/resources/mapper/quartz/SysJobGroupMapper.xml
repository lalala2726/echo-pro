<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.zhangchuangla.quartz.mapper.SysJobGroupMapper">

    <resultMap id="BaseResultMap" type="cn.zhangchuangla.quartz.entity.SysJobGroup">
        <id column="id" property="id" jdbcType="BIGINT"/>
        <result column="group_name" property="groupName" jdbcType="VARCHAR"/>
        <result column="group_code" property="groupCode" jdbcType="VARCHAR"/>
        <result column="group_description" property="groupDescription" jdbcType="VARCHAR"/>
        <result column="status" property="status" jdbcType="INTEGER"/>
        <result column="sort" property="sort" jdbcType="INTEGER"/>
        <result column="create_time" property="createTime" jdbcType="TIMESTAMP"/>
        <result column="update_time" property="updateTime" jdbcType="TIMESTAMP"/>
        <result column="create_by" property="createBy" jdbcType="VARCHAR"/>
        <result column="update_by" property="updateBy" jdbcType="VARCHAR"/>
        <result column="remark" property="remark" jdbcType="VARCHAR"/>
    </resultMap>

    <sql id="Base_Column_List">
        id, group_name, group_code, group_description, status, sort,
        create_time, update_time, create_by, update_by, remark
    </sql>

    <select id="selectJobGroupList" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM sys_job_group
        <where>
            <if test="request.groupName != null and request.groupName != ''">
                AND group_name LIKE CONCAT('%', #{request.groupName}, '%')
            </if>
            <if test="request.groupCode != null and request.groupCode != ''">
                AND group_code LIKE CONCAT('%', #{request.groupCode}, '%')
            </if>
            <if test="request.status != null">
                AND status = #{request.status}
            </if>
        </where>
        ORDER BY sort ASC, id ASC
    </select>

    <select id="selectEnabledGroups" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM sys_job_group
        WHERE status = 0
        ORDER BY sort ASC, id ASC
    </select>

    <select id="checkGroupNameExists" resultType="int">
        SELECT COUNT(1)
        FROM sys_job_group
        WHERE group_name = #{groupName}
        <if test="id != null">
            AND id != #{id}
        </if>
    </select>

    <select id="checkGroupCodeExists" resultType="int">
        SELECT COUNT(1)
        FROM sys_job_group
        WHERE group_code = #{groupCode}
        <if test="id != null">
            AND id != #{id}
        </if>
    </select>

    <select id="countJobsByGroupId" resultType="int">
        SELECT COUNT(1)
        FROM sys_job
        WHERE job_group_id = #{groupId}
    </select>

</mapper>
